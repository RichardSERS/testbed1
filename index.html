<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>3D Model Viewer</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
      body { margin: 0; background: #111; color: white; font-family: sans-serif; }
      #loader {
        position: absolute;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: #111;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }
      #progress-bar {
        width: 50%;
        height: 10px;
        background: #333;
        margin-top: 20px;
        border-radius: 5px;
        overflow: hidden;
      }
      #progress {
        height: 100%;
        background: #0f0;
        width: 0%;
        transition: width 0.3s;
      }
      model-viewer {
        width: 100vw;
        height: 100vh;
      }
      #version {
        position: absolute;
        bottom: 10px;
        right: 10px;
        font-size: 12px;
        color: #ccc;
      }
    </style>
  </head>
  <body>
    <div id="loader">
      <div>Loading 3D model...</div>
      <div id="progress-bar"><div id="progress"></div></div>
    </div>

    <model-viewer
      src=src="https://github.com/RichardSERS/testbed1/raw/main/model.glb"
      alt="3D model"
      auto-rotate
      camera-controls
      background-color="#222"
      exposure="1.1"
      shadow-intensity="1"
      camera-orbit="0deg 75deg auto"
      min-camera-orbit="auto 45deg auto"
      max-camera-orbit="auto 85deg auto"
      disable-zoom="false"
      ar
      ar-modes="webxr scene-viewer quick-look"
      loading="eager"
      reveal="auto"
      id="viewer">
    </model-viewer>

    <div id="version">v2.0</div>

    <script>
      const viewer = document.querySelector('model-viewer');
      const loader = document.getElementById('loader');
      const progressBar = document.getElementById('progress');

      // Progress event handling
      viewer.addEventListener('progress', (event) => {
        const percent = Math.round(event.detail.totalProgress * 100);
        progressBar.style.width = percent + '%';
      });

      // Load complete
      viewer.addEventListener('load', () => {
        loader.style.display = 'none';
        console.log('Model loaded successfully');
      });

      // Fallback: force hide loader after 20 seconds
      setTimeout(() => {
        loader.style.display = 'none';
        console.warn('Model viewer fallback triggered (timeout)');
      }, 20000);
    </script>
  </body>
</html>
